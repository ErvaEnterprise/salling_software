<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Voice Entry | Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-white flex flex-col min-h-screen">

  <!-- Header -->
  <%- include('./partials/header') %>

  <div class="flex flex-1 flex-col md:flex-row">
    <!-- Sidebar (hidden on mobile, show as slideout if needed) -->
    <div class="md:block hidden">
      <%- include('./partials/sidebar') %>
    </div>
    <!-- Mobile Sidebar Button -->
    <div class="block md:hidden">
      <!-- Optionally, add a sidebar toggle button here for mobile -->
    </div>

    <!-- Main Content -->
    <main class="flex-1 p-4 sm:p-6 md:p-8">
      <section class="w-full max-w-lg mx-auto bg-white dark:bg-gray-800 p-4 sm:p-6 rounded-lg shadow space-y-6">

        <h2 class="text-xl sm:text-2xl font-bold text-center">üé§ Voice Entry Form</h2>

        <!-- Language Selector -->
        <div>
          <label for="langSelect" class="block mb-1 font-medium">Select Language</label>
          <select id="langSelect" onchange="updateLang()" class="w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:text-white dark:border-gray-600">
            <option value="en-IN">English</option>
            <option value="hi-IN">‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
            <option value="gu-IN">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä</option>
          </select>
        </div>

        <!-- Voice Button -->
        <div>
          <button type="button" onclick="startVoice()" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded">
            üéôÔ∏è Speak Entry
          </button>
          <p id="voiceOutput" class="mt-2 text-sm text-gray-600 dark:text-gray-300"></p>
        </div>

        <!-- Purchase Form -->
        <form method="POST" action="/purchase" class="space-y-2">
          <input name="product" id="product" placeholder="Product" required class="w-full border p-2 rounded dark:bg-gray-700 dark:border-gray-600" />
          <input name="quantity" id="quantity" type="number" placeholder="Quantity" required class="w-full border p-2 rounded dark:bg-gray-700 dark:border-gray-600" />
          <input name="total" id="total" type="number" placeholder="Total Amount" required class="w-full border p-2 rounded dark:bg-gray-700 dark:border-gray-600" />
          <input name="supplier" id="supplier" placeholder="Supplier Name" class="w-full border p-2 rounded dark:bg-gray-700 dark:border-gray-600" />
          <!-- Admin Selector -->
          <select name="adminId" required class="w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:text-white dark:border-gray-600">
            <option value="">Select Admin</option>
            <% adminsList.forEach(admin => { %>
              <option value="<%= admin._id %>"><%= admin.name %></option>
            <% }) %>
          </select>
          <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">
            Submit Purchase
          </button>
        </form>

      </section>
    </main>
  </div>

  <!-- Footer -->
  <%- include('./partials/footer') %>

  <!-- Voice Script -->
  <script>
    let lang = 'en-IN';
    function updateLang() {
      lang = document.getElementById('langSelect').value;
    }
    function startVoice() {
      const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = lang;
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;
      recognition.start();
      recognition.onresult = function (event) {
        const speech = event.results[0][0].transcript.toLowerCase();
        document.getElementById('voiceOutput').innerText = 'You said: ' + speech;
        const productMatch = speech.match(/product\s+([\w\s]+)/);
        const quantityMatch = speech.match(/quantity\s+(\d+)/);
        const totalMatch = speech.match(/total\s+(\d+)/);
        const supplierMatch = speech.match(/supplier\s+([\w\s]+)/);
        if (productMatch) document.getElementById('product').value = productMatch[1].trim();
        if (quantityMatch) document.getElementById('quantity').value = quantityMatch[1].trim();
        if (totalMatch) document.getElementById('total').value = totalMatch[1].trim();
        if (supplierMatch) document.getElementById('supplier').value = supplierMatch[1].trim();
      };
      recognition.onerror = function (event) {
        document.getElementById('voiceOutput').innerText = 'Error: ' + event.error;
      };
    }
  </script>
</body>
</html>